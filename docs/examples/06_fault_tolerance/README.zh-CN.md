# 示例 6：容错与系统自适应

本示例演示了一种更高级的分布式系统能力：检测组件故障并调整系统行为以减轻其影响。

## 场景

我们有一个包含两个并联水库的系统，分别是 `reservoir_A` 和 `reservoir_B`。每个水库都有自己的入流和一个下游闸门，分别是 `gate_A` 和 `gate_B`。

控制系统分为三层结构：
1.  **本地控制**：两个 `LocalGateControlAgent` 实例（`controller_A` 和 `controller_B`）负责通过开启和关闭各自的闸门，将相应水库的水位维持在 51.0 米的目标水位。
2.  **故障注入**：引入一个特殊的 `FailureInjectionAgent` 来模拟故障。在 `t=150` 秒时，它将向 `controller_A` 发送一个“关闭”命令来“杀死”它，使其无法控制 `gate_A`。
3.  **监督控制**：一个 `SupervisoryAgent` 监控两个水库的水位。如果它检测到其中一个水库的水位与另一个相差过大（超过 1.0 米），它会判定发生了故障。然后，它会采取纠正措施，命令*健康*的控制器（`controller_B`）切换到更激进的控制策略（一个更低的目标水位 50.2 米），以增加其出流量来弥补故障造成的影响。

这展示了一个能够实现以下功能的容错系统：
-   检测异常（组件故障导致状态偏离）。
-   调整其策略以继续追求总体系统目标（管理水位）。

## 如何运行

要运行此模拟，请执行此目录中的 `run.py` 脚本：

```bash
python run.py
```
您将观察到两个系统都正常运行。在 t=150秒时，`controller_A` 将发生故障。不久之后，`reservoir_A` 的水位将上升，触发监督代理向 `controller_B` 发出指令，将其目标水位设置为一个新的、更低的值。
