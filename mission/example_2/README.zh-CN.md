# 示例 2: 闭环与分层控制系统

本目录中的示例（2.1 至 2.3）着重于演示如何将独立的智能体（Agent）组合成一个完整的、可运行的闭环控制系统，并逐步构建更高级的分层与联合调度策略。

## 示例说明

### `example_2_1_local_closed_loop.py`
*   **目标**: 演示一个完整的、独立的现地（本地）闭环控制系统。
*   **内容**: 此示例使用 `SimulationHarness` 仿真引擎来集成一个完整的场景。它包含：
    1.  一个 `PhysicalIOAgent`，负责感知渠池水位并执行闸门动作。
    2.  一个 `LocalControlAgent`，内置PID控制器，根据感知到的水位自动调节闸门。
    3.  一个 `RainfallAgent`，模拟持续的外部扰动（上游来水）。
    整个系统在没有中央干预的情况下，自主地将渠池水位稳定在预设的目标值附近。
*   **核心概念**: 仿真引擎（`SimulationHarness`），完整的本地反馈控制回路，扰动响应。

### `example_2_2_hierarchical_control.py`
*   **目标**: 演示一个两级分层控制系统，引入预测与优化能力。
*   **内容**: 此示例在本地PID控制的基础上，增加了一个更高层次的中央调度智能体 `CentralMPCAgent`（模型预测控制）。
    1.  **上层 (MPC)**: 该智能体能接收未来的天气预报（例如，未来几小时有大暴雨），通过其内部优化模型，计算出最优的应对策略。它不下达具体的闸门开度，而是向前瞻性地调整下层PID控制器的**目标水位**（例如，在暴雨来临前，提前降低水库的目标水位以腾出库容）。
    2.  **下层 (PID)**: 本地PID控制器忠实地执行来自上层MPC的新设定点。
*   **核心概念**: 分层控制，模型预测控制（MPC），前瞻性控制，优化调度。

### `example_2_3_joint_dispatch.py`
*   **目标**: 演示一个更复杂的流域联合调度场景。
*   **内容**: 此示例模拟了一个包含多种水利设施的流域：一个上游水库、一个水电站（包含发电机组和泄洪闸）以及一个下游灌溉取水口。系统面临的挑战是，在应对上游洪水的同时，还要满足下游的用水需求。
    *   一个基于规则的 `CentralDispatcher` 智能体作为中央大脑，根据当前流域的整体状态（例如，水库水位是否超过汛限水位）切换全局策略（如“正常模式” vs “防洪模式”）。
    *   多个 `LocalControlAgent` 分别控制水电站和灌溉闸门，它们接收来自中央调度器的指令，并将其转化为对具体设备的控制动作。例如，在防洪模式下，水电站被命令加大下泄流量，而灌溉口则被命令关闭。
*   **核心概念**: 流域联合调度，多目标协调，基于规则的专家系统，多智能体协作。

## 如何运行

你可以按顺序依次执行这些Python脚本，来理解不同层次的控制策略：

```bash
python mission/example_2/example_2_1_local_closed_loop.py
python mission/example_2/example_2_2_hierarchical_control.py
python mission/example_2/example_2_3_joint_dispatch.py
```
